version: "3.9"

services:
  comfyui:
    image: ghcr.io/damjanp/comfyui:latest
    container_name: comfyui
    gpus: all

    environment:
      TZ: Europe/Ljubljana
      NVIDIA_VISIBLE_DEVICES: "all"
      NVIDIA_DRIVER_CAPABILITIES: "compute,utility"

    # Choose whichever GPU syntax matches your Docker version:
    # For older setups (nvidia-container-runtime):
    runtime: nvidia
    # For newer Docker:
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - capabilities: ["gpu"]

    volumes:
      - /home/damjan/ComfyUI/ComfyUI/user:/opt/ComfyUI/user
      - /home/damjan/ComfyUI/ComfyUI/custom_nodes:/opt/ComfyUI/custom_nodes
      - /home/damjan/ComfyUI/ComfyUI/models:/opt/ComfyUI/models
      - /home/damjan/ComfyUI/ComfyUI/input:/opt/ComfyUI/input
      - /home/damjan/ComfyUI/ComfyUI/output:/opt/ComfyUI/output

    ports:
      - "8188:8188"

    restart: unless-stopped
