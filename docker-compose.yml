version: "3.9"

services:
  comfyui:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: comfyui

    restart: unless-stopped

    # âœ… Modern GPU flag for non-Swarm Docker / Portainer
    gpus: all

    environment:
      # Optional ComfyUI flags as env var if you want to override
      # e.g. add --cuda-device 0, --highvram etc.
      # COMFY_ARGS: "--highvram"
      # We'll wire this into the command below if you like later.
      TZ: Europe/Ljubljana

    # Persist user data, custom nodes, models and IO
    volumes:
      - /home/damjan/ComfyUI/ComfyUI/user:/opt/ComfyUI/user
      - /home/damjan/ComfyUI/ComfyUI/custom_nodes:/opt/ComfyUI/custom_nodes
      - /home/damjan/ComfyUI/ComfyUI/models:/opt/ComfyUI/models
      - /home/damjan/ComfyUI/ComfyUI/input:/opt/ComfyUI/input
      - /home/damjan/ComfyUI/ComfyUI/output:/opt/ComfyUI/output

    ports:
      - "8188:8188"

    # Still fine to keep this for older setups
    runtime: nvidia
